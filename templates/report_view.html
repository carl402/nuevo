{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2 class="text-primary"><i class="fas fa-chart-bar me-2"></i>{{ report.name }}</h2>
          <p class="text-muted mb-0">
            <i class="fas fa-folder me-1"></i>{{ report.project.name }} | 
            <i class="fas fa-calendar me-1"></i>{{ report.created_at.strftime('%d/%m/%Y %H:%M') }}
          </p>
        </div>
        <div>
          <a class="btn btn-primary" href="{{ url_for('report_download_pdf', report_id=report.id) }}">
            <i class="fas fa-file-pdf me-1"></i>PDF
          </a>
          <a class="btn btn-success" href="{{ url_for('report_download_docx', report_id=report.id) }}">
            <i class="fas fa-file-word me-1"></i>DOCX
          </a>
          <a class="btn btn-outline-secondary" href="{{ url_for('reports_list') }}">
            <i class="fas fa-arrow-left me-1"></i>Volver
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Estadísticas principales -->
    <div class="col-md-3 mb-3">
      <div class="stats-card">
        <div class="stats-value">{{ "%.2f"|format(report.results.summary.mean) }}</div>
        <div class="stats-label">Media</div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="stats-card">
        <div class="stats-value">{{ "%.2f"|format(report.results.summary.std) }}</div>
        <div class="stats-label">Desviación Estándar</div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="stats-card">
        <div class="stats-value">{{ "%.2f"|format(report.results.summary.min) }}</div>
        <div class="stats-label">Mínimo</div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="stats-card">
        <div class="stats-value">{{ "%.2f"|format(report.results.summary.max) }}</div>
        <div class="stats-label">Máximo</div>
      </div>
    </div>
  </div>

  <!-- Gráficos -->
  {% if report.results.charts %}
  <div class="row">
    <div class="col-12">
      <div class="chart-container">
        <h4 class="mb-3"><i class="fas fa-chart-area me-2"></i>Análisis Visual</h4>
        <img src="data:image/png;base64,{{ report.results.charts.histogram_density }}" 
             class="img-fluid" alt="Histograma y Curva de Densidad">
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Tabla de métricas detalladas -->
  <div class="row">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0"><i class="fas fa-calculator me-2"></i>Métricas Estadísticas</h5>
        </div>
        <div class="card-body">
          <table class="table table-sm">
            <tr><td><strong>Media:</strong></td><td>{{ "%.4f"|format(report.results.summary.mean) }}</td></tr>
            <tr><td><strong>Mediana:</strong></td><td>{{ "%.4f"|format(report.results.summary.median) }}</td></tr>
            <tr><td><strong>Desv. Estándar:</strong></td><td>{{ "%.4f"|format(report.results.summary.std) }}</td></tr>
            <tr><td><strong>Varianza:</strong></td><td>{{ "%.4f"|format(report.results.summary.variance) }}</td></tr>
            <tr><td><strong>Mínimo:</strong></td><td>{{ "%.4f"|format(report.results.summary.min) }}</td></tr>
            <tr><td><strong>Máximo:</strong></td><td>{{ "%.4f"|format(report.results.summary.max) }}</td></tr>
          </table>
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-warning text-dark">
          <h5 class="mb-0"><i class="fas fa-percentage me-2"></i>Percentiles</h5>
        </div>
        <div class="card-body">
          <table class="table table-sm">
            <tr><td><strong>Percentil 5%:</strong></td><td>{{ "%.4f"|format(report.results.summary.percentile_5) }}</td></tr>
            <tr><td><strong>Percentil 25%:</strong></td><td>{{ "%.4f"|format(report.results.summary.get('percentiles', {}).get('p25', 0)) }}</td></tr>
            <tr><td><strong>Percentil 50% (Mediana):</strong></td><td>{{ "%.4f"|format(report.results.summary.median) }}</td></tr>
            <tr><td><strong>Percentil 75%:</strong></td><td>{{ "%.4f"|format(report.results.summary.get('percentiles', {}).get('p75', 0)) }}</td></tr>
            <tr><td><strong>Percentil 95%:</strong></td><td>{{ "%.4f"|format(report.results.summary.percentile_95) }}</td></tr>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}